<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ ì¶œì„ì²´í¬ - SK ë©˜í†  ê°€ì´ë“œ</title>
    <meta name="theme-color" content="#EA1917">
    
    <script>
        function goBack() {
            try {
                if (window.history.length > 1) {
                    window.history.back();
                    return;
                }
            } catch (e) {
                console.log('history.back() ì‹¤íŒ¨:', e);
            }

            try {
                const currentUrl = window.location.href;
                const parentUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/'));
                if (parentUrl && parentUrl !== currentUrl) {
                    window.location.href = parentUrl;
                    return;
                }
            } catch (e) {
                console.log('ìƒìœ„ í´ë” ì´ë™ ì‹¤íŒ¨:', e);
            }

            try {
                window.location.href = '../index.html';
            } catch (e) {
                console.log('index.html ì´ë™ ì‹¤íŒ¨:', e);
                window.open('../index.html', '_blank');
            }
        }
    </script>

    <style>
        :root {
            --sk-red: #EA1917;
            --sk-orange: #FF6B35;
            --success: #4CAF50;
            --warning: #FF9800;
            --info: #2196F3;
            --purple: #9C27B0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
            color: #333;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--sk-orange) 0%, var(--sk-red) 100%);
            color: white;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 16px;
            transition: background 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 10;
        }

        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 10;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Section */
        .section {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06);
        }

        .section h2 {
            font-size: 20px;
            margin-bottom: 16px;
            color: var(--sk-red);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ì‹œê°„ëŒ€ ì„ íƒ */
        .time-selector {
            background: linear-gradient(135deg, rgba(234,25,23,0.05), rgba(255,107,53,0.05));
            border: 2px solid var(--sk-red);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .time-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .time-option {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .time-option:hover {
            border-color: var(--sk-red);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(234,25,23,0.2);
        }

        .time-option.selected {
            border-color: var(--sk-red);
            background: linear-gradient(135deg, rgba(234,25,23,0.08), rgba(255,107,53,0.08));
        }

        .time-option h3 {
            color: var(--sk-red);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .time-option p {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        /* ì¶œì„ í˜„í™© */
        .attendance-form {
            background: rgba(248,249,250,0.8);
            backdrop-filter: blur(10px);
            border: 2px solid var(--sk-red);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }

        .form-section {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            border-left: 4px solid var(--sk-red);
        }

        .form-section h4 {
            color: var(--sk-red);
            margin-bottom: 16px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .attendance-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.9);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--sk-red);
            box-shadow: 0 0 0 2px rgba(234,25,23,0.2);
        }

        .form-input.error {
            border-color: #f44336;
            background-color: #fff5f5;
        }

        .form-input.valid {
            border-color: var(--success);
            background-color: #f8fff8;
        }

        /* íŠ¹ì´ì‚¬í•­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .special-notes-section {
            grid-column: 1 / -1;
        }

        .special-notes-textarea {
            min-height: 120px;
            max-height: 300px;
            line-height: 1.5;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            width: 100%;
            background: rgba(255,255,255,0.9);
        }

        .special-notes-textarea:focus {
            outline: none;
            border-color: var(--sk-red);
            box-shadow: 0 0 0 2px rgba(234,25,23,0.2);
        }

        .character-count {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .character-count.warning {
            color: #ff9800;
        }

        .character-count.error {
            color: #f44336;
        }

        /* ê¸°í”„í‹°ì½˜ ì§€ê¸‰ */
        .gifticon-section {
            background: linear-gradient(135deg, rgba(255,152,0,0.05), rgba(252,228,236,0.05));
            border: 2px solid var(--warning);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
        }

        .gifticon-title {
            color: #e65100;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
        }

        .gifticon-list {
            display: grid;
            gap: 16px;
        }

        .gifticon-item {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--warning);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 16px;
        }

        .gifticon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .gifticon-number {
            background: var(--warning);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .remove-gifticon {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .remove-gifticon:hover {
            background: #d32f2f;
        }

        .gifticon-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .gifticon-form .attendance-item:nth-child(4) {
            grid-column: 1 / -1;
        }

        .add-gifticon {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .add-gifticon:hover {
            background: linear-gradient(135deg, #f57c00, #ef6c00);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        /* ì œì¶œ ì„¹ì…˜ */
        .submit-section {
            background: linear-gradient(135deg, rgba(76,175,80,0.08), rgba(241,248,233,0.8));
            border: 2px solid var(--success);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }

        .submit-button {
            background: linear-gradient(135deg, var(--success), #66bb6a);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(76, 175, 80, 0.4);
        }

        .submit-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .submit-status {
            margin-top: 12px;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .submit-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .submit-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .submit-status.loading {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        /* ì•ˆë‚´ ë°•ìŠ¤ */
        .info-box {
            background: linear-gradient(135deg, rgba(255,243,224,0.8), rgba(252,228,236,0.8));
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            backdrop-filter: blur(10px);
        }

        .info-title {
            font-weight: 600;
            color: #e65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 4px;
            min-height: 18px;
            display: block;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .section {
                padding: 20px;
                margin-bottom: 16px;
                border-radius: 16px;
            }
            
            .header h1 {
                font-size: 20px;
            }

            .header .subtitle {
                font-size: 14px;
            }

            .time-options {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .time-option {
                padding: 16px;
            }

            .time-option h3 {
                font-size: 16px;
            }

            .time-option p {
                font-size: 13px;
            }

            .attendance-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .form-input {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
                padding: 14px 12px;
            }

            .special-notes-textarea {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
                min-height: 100px;
                padding: 14px 12px;
            }

            .gifticon-form {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .gifticon-form .attendance-item:nth-child(4) {
                grid-column: 1;
            }

            .gifticon-item {
                padding: 16px;
            }

            .submit-button {
                padding: 18px 24px;
                font-size: 15px;
                width: 100%;
            }

            .add-gifticon {
                padding: 16px 20px;
                font-size: 14px;
                width: 100%;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ í•„ë“œ ìµœì í™” */
            .form-section {
                padding: 16px;
            }

            .attendance-form, .time-selector, .gifticon-section, .submit-section {
                padding: 16px;
            }

            .info-box {
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            .section {
                padding: 16px;
            }

            .header {
                padding: 16px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header .subtitle {
                font-size: 13px;
            }

            .time-option {
                padding: 12px;
            }

            .gifticon-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <button class="back-button" onclick="goBack()">â† ë’¤ë¡œê°€ê¸°</button>
        <h1>ğŸ“‹ ì¶œì„ì²´í¬ ì‹œìŠ¤í…œ</h1>
        <div class="subtitle">ì˜¤ì „ 9ì‹œ & ì˜¤í›„ 2ì‹œ ì¶œì„ í˜„í™© ì œì¶œ</div>
    </div>

    <div class="container">
        <!-- ì‹œê°„ëŒ€ ì„ íƒ -->
        <div class="section">
            <h2>â° ì¶œì„ì²´í¬ ì‹œê°„ëŒ€ ì„ íƒ</h2>
            <div class="time-selector">
                <div class="time-options">
                    <div class="time-option" data-time="morning" onclick="selectTime('morning')">
                        <h3>ğŸŒ… ì˜¤ì „ ì¶œì„ì²´í¬</h3>
                        <p>ì˜¤ì „ 9ì‹œ ê¸°ì¤€<br>êµìœ¡ ì‹œì‘ ì „ ì¶œì„ í˜„í™©</p>
                    </div>
                    <div class="time-option" data-time="afternoon" onclick="selectTime('afternoon')">
                        <h3>ğŸŒ ì˜¤í›„ ì¶œì„ì²´í¬</h3>
                        <p>ì˜¤í›„ 2ì‹œ ê¸°ì¤€<br>ì ì‹¬ í›„ ì¶œì„ í˜„í™©</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¶œì„ í˜„í™© í¼ -->
        <div class="section">
            <h2>ğŸ“Š ì¶œì„ í˜„í™© ì…ë ¥</h2>
            <div class="attendance-form">
                <div class="form-section">
                    <h4>ğŸ‘¥ ì¶œì„ ì¸ì› í˜„í™©</h4>
                    <div class="attendance-grid">
                        <div class="attendance-item">
                            <label class="form-label">ì´ ì¸ì›</label>
                            <input type="number" class="form-input" id="totalCount" placeholder="12" min="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">ì¶œì„</label>
                            <input type="number" class="form-input" id="presentCount" placeholder="11" min="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">ì§€ê°</label>
                            <input type="number" class="form-input" id="lateCount" placeholder="1" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">ê²°ì„</label>
                            <input type="number" class="form-input" id="absentCount" placeholder="0" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">ì¡°í‡´</label>
                            <input type="number" class="form-input" id="earlyLeaveCount" placeholder="0" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                    </div>
                </div>

                <div class="form-section special-notes-section">
                    <h4>ğŸ“ íŠ¹ì´ì‚¬í•­</h4>
                    <textarea class="special-notes-textarea" id="specialNotes" placeholder="ì§€ê°/ê²°ì„/ì¡°í‡´ ì‚¬ìœ , ì»¨ë””ì…˜ ë‚œì¡°ì, ê¸°íƒ€ íŠ¹ì´ì‚¬í•­ ë“±ì„ ìì„¸íˆ ê¸°ë¡í•´ì£¼ì„¸ìš”.&#10;&#10;ì˜ˆì‹œ:&#10;- í™ê¸¸ë™: êµí†µì²´ì¦ìœ¼ë¡œ ì¸í•œ ì§€ê° (15ë¶„)&#10;- ê¹€ì² ìˆ˜: ëª¸ì‚´ ê¸°ìš´ìœ¼ë¡œ ì»¨ë””ì…˜ ë‚œì¡°&#10;- ì´ì˜í¬: ê¸‰í•œ ì—…ë¬´ë¡œ ì¸í•œ ì¡°í‡´ (16:30)" maxlength="500" oninput="updateCharacterCount()"></textarea>
                    <div class="character-count" id="notesCharCount">0 / 500ì</div>
                </div>
            </div>
        </div>

        <!-- ê¸°í”„í‹°ì½˜ ì§€ê¸‰ í˜„í™© -->
        <div class="section">
            <h2>ğŸ ê¸°í”„í‹°ì½˜ ì§€ê¸‰ í˜„í™©</h2>
            <div class="gifticon-section">
                <div class="gifticon-title">ğŸ‰ ì°¸ì—¬ ë…ë ¤ ê¸°í”„í‹°ì½˜ ì§€ê¸‰</div>
                
                <div class="info-box">
                    <div class="info-title">ğŸ’¡ ê¸°í”„í‹°ì½˜ ì§€ê¸‰ ê°€ì´ë“œ</div>
                    <ul style="margin-left: 16px; margin-top: 8px;">
                        <li>ì ê·¹ì  ì°¸ì—¬, ìš°ìˆ˜í•œ ë°œí‘œ, íŒ€ì›Œí¬ í–¥ìƒ ë“±ì— ëŒ€í•œ ê²©ë ¤</li>
                        <li>ë§¤ì¼ ê¸°ë¡í•  í•„ìš”ëŠ” ì—†ìœ¼ë©°, íŠ¹ë³„í•œ ê²½ìš°ì—ë§Œ ì§€ê¸‰</li>
                        <li>ìˆ˜ë ¹ì ì •ë³´ëŠ” ê¸°í”„í‹°ì½˜ ë°œì†¡ì„ ìœ„í•´ ì •í™•íˆ ê¸°ì…</li>
                    </ul>
                </div>

                <div class="gifticon-list" id="gifticonList">
                    <!-- ê¸°í”„í‹°ì½˜ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>

                <button class="add-gifticon" onclick="addGifticonItem()">+ ê¸°í”„í‹°ì½˜ ì§€ê¸‰ ì¶”ê°€</button>
            </div>
        </div>

        <!-- ì œì¶œ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“¤ ì¶œì„ì²´í¬ ì œì¶œ</h2>
            <div class="submit-section">
                <h3 style="margin-bottom: 16px; color: #2e7d32;">âœ… ìš´ì˜ì§„ì—ê²Œ ìë™ ì œì¶œ</h3>
                <p style="margin-bottom: 20px; color: #666;">
                    ì œì¶œí•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¶œì„ í˜„í™©ì´ ìš´ì˜ì§„ì—ê²Œ ìë™ìœ¼ë¡œ ì œì¶œë©ë‹ˆë‹¤.<br>
                    ì œì¶œ ì „ ë‚´ìš©ì„ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.
                </p>
                
                <button class="submit-button" onclick="submitAttendance()" id="submitBtn">
                    ğŸ“¤ ìš´ì˜ì§„ì—ê²Œ ì œì¶œí•˜ê¸°
                </button>
                
                <div class="submit-status" id="submitStatus"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedTime = '';
        let gifticonCount = 0;

        // Apps Script ê´€ë¦¬ í´ë˜ìŠ¤
        class AppsScriptManager {
            constructor() {
                // ğŸ”§ ì—¬ê¸°ì— ì‹¤ì œ Apps Script ì›¹ì•± URLì„ ì…ë ¥í•˜ì„¸ìš”
                this.APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx_sWKPsECUK7VvG9-6p8HNw_7s2h3C_VLxlOn7_PlHaZiRvyJWVAYBrr8nfEPDpIXJTw/exec';
                this.isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            }

            getAppsScriptUrl() {
                // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸
                if (this.isDevelopment) {
                    const devUrl = localStorage.getItem('sk-mentor-apps-script-url');
                    if (devUrl) return devUrl;
                }
                
                // ì‹¤ì œ URL ì‚¬ìš©
                return this.APPS_SCRIPT_URL;
            }

            createSubmissionData(type, formData) {
                const mentorInfo = JSON.parse(localStorage.getItem('sk-mentor-info') || '{}');
                
                const baseData = {
                    type: type,
                    mentorName: mentorInfo.name || localStorage.getItem('sk-mentor-name') || 'ë¯¸ì…ë ¥',
                    teamNumber: mentorInfo.teamNumber || '',
                    trainingCenter: mentorInfo.trainingCenter || '',
                    submittedAt: new Date().toLocaleString('ko-KR')
                };
                
                return { ...baseData, ...formData };
            }

            async submitData(data) {
                const url = this.getAppsScriptUrl();
                
                if (!url) {
                    throw new Error('Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìš´ì˜ì§„ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
                }

                console.log('ğŸ“¤ ì „ì†¡ ë°ì´í„°:', data);

                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                return { success: true, message: 'ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤' };
            }

            saveOfflineData(data) {
                const offlineData = JSON.parse(localStorage.getItem('sk-mentor-offline-submissions') || '[]');
                offlineData.push({
                    ...data,
                    id: Date.now(),
                    status: 'pending',
                    savedAt: new Date().toISOString()
                });
                localStorage.setItem('sk-mentor-offline-submissions', JSON.stringify(offlineData));
            }

            saveSubmissionRecord(data) {
                const submissions = JSON.parse(localStorage.getItem('sk-mentor-submissions') || '[]');
                submissions.push({
                    ...data,
                    id: Date.now(),
                    status: 'submitted'
                });
                localStorage.setItem('sk-mentor-submissions', JSON.stringify(submissions));
            }
        }

        // ì‹œê°„ëŒ€ ì„ íƒ
        function selectTime(time) {
            selectedTime = time;
            
            // ëª¨ë“  ì˜µì…˜ ë¹„ì„ íƒ
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ì„ íƒëœ ì˜µì…˜ í‘œì‹œ
            document.querySelector(`[data-time="${time}"]`).classList.add('selected');
            
            // í¼ í™œì„±í™”
            enableForm();
        }

        // í¼ í™œì„±í™”
        function enableForm() {
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = false;
            });
        }

        // ì¶œì„ ì¸ì› ìœ íš¨ì„± ê²€ì‚¬
        function validateAttendanceNumbers() {
            const total = parseInt(document.getElementById('totalCount').value) || 0;
            const present = parseInt(document.getElementById('presentCount').value) || 0;
            const late = parseInt(document.getElementById('lateCount').value) || 0;
            const absent = parseInt(document.getElementById('absentCount').value) || 0;
            const earlyLeave = parseInt(document.getElementById('earlyLeaveCount').value) || 0;

            const sum = present + late + absent + earlyLeave;
            
            // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const inputs = [
                document.getElementById('totalCount'),
                document.getElementById('presentCount'),
                document.getElementById('lateCount'),
                document.getElementById('absentCount'),
                document.getElementById('earlyLeaveCount')
            ];

            inputs.forEach(input => {
                input.classList.remove('error', 'valid');
            });

            if (total > 0 && sum === total) {
                inputs.forEach(input => input.classList.add('valid'));
            } else if (total > 0 && sum !== total) {
                inputs.forEach(input => input.classList.add('error'));
            }
        }

        // íŠ¹ì´ì‚¬í•­ ê¸€ììˆ˜ ì¹´ìš´íŠ¸
        function updateCharacterCount() {
            const textarea = document.getElementById('specialNotes');
            const counter = document.getElementById('notesCharCount');
            const length = textarea.value.length;
            
            counter.textContent = `${length} / 500ì`;
            
            counter.classList.remove('warning', 'error');
            if (length > 450) {
                counter.classList.add('warning');
            }
            if (length > 500) {
                counter.classList.add('error');
            }
        }

        // ê¸°í”„í‹°ì½˜ í•­ëª© ì¶”ê°€
        function addGifticonItem() {
            gifticonCount++;
            const gifticonList = document.getElementById('gifticonList');
            
            const gifticonItem = document.createElement('div');
            gifticonItem.className = 'gifticon-item';
            gifticonItem.id = `gifticon-${gifticonCount}`;
            
            gifticonItem.innerHTML = `
                <div class="gifticon-header">
                    <span class="gifticon-number">#${gifticonCount}</span>
                    <button class="remove-gifticon" onclick="removeGifticonItem(${gifticonCount})">ì‚­ì œ</button>
                </div>
                <div class="gifticon-form">
                    <div class="attendance-item">
                        <label class="form-label">ì´ë¦„ <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" placeholder="í™ê¸¸ë™" data-field="name" required oninput="validateGifticonField(this, 'name')">
                        <div class="error-message" data-error="name"></div>
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">íšŒì‚¬</label>
                        <input type="text" class="form-input" placeholder="SKí…”ë ˆì½¤" data-field="company">
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">í•¸ë“œí°ë²ˆí˜¸ <span style="color: red;">*</span></label>
                        <input type="tel" class="form-input" placeholder="010-1234-5678" data-field="phone" required oninput="validateGifticonField(this, 'phone')">
                        <div class="error-message" data-error="phone"></div>
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">ì§€ê¸‰ ì‚¬ìœ  <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" placeholder="ì ê·¹ì ì¸ ë°œí‘œ ì°¸ì—¬, ìš°ìˆ˜í•œ íŒ€ì›Œí¬ ë“±" data-field="reason" required oninput="validateGifticonField(this, 'reason')">
                        <div class="error-message" data-error="reason"></div>
                    </div>
                </div>
            `;
            
            gifticonList.appendChild(gifticonItem);
        }

        // ê¸°í”„í‹°ì½˜ í•­ëª© ì‚­ì œ
        function removeGifticonItem(id) {
            const item = document.getElementById(`gifticon-${id}`);
            if (item) {
                item.remove();
            }
        }

        // ê¸°í”„í‹°ì½˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
        function validateGifticonField(input, type) {
            const errorElement = input.parentElement.querySelector(`[data-error="${type}"]`);
            let isValid = true;
            let errorMessage = '';

            input.classList.remove('error', 'valid');

            if (input.value.trim()) {
                switch (type) {
                    case 'name':
                        if (input.value.trim().length < 2) {
                            isValid = false;
                            errorMessage = 'ì´ë¦„ì€ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                        }
                        break;
                    case 'phone':
                        if (!validatePhoneNumber(input.value)) {
                            isValid = false;
                            errorMessage = 'ì˜¬ë°”ë¥¸ í•¸ë“œí°ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)';
                        }
                        break;
                    case 'reason':
                        if (input.value.trim().length < 2) {
                            isValid = false;
                            errorMessage = 'ì§€ê¸‰ ì‚¬ìœ ë¥¼ ìì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                        }
                        break;
                }

                if (isValid) {
                    input.classList.add('valid');
                } else {
                    input.classList.add('error');
                }
            }

            if (errorElement) {
                errorElement.textContent = errorMessage;
            }

            return isValid;
        }

        // ì „ì²´ í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateAllForms() {
            let isValid = true;

            // ì¶œì„ ì¸ì› ê²€ì‚¬
            const total = parseInt(document.getElementById('totalCount').value) || 0;
            const present = parseInt(document.getElementById('presentCount').value) || 0;
            const late = parseInt(document.getElementById('lateCount').value) || 0;
            const absent = parseInt(document.getElementById('absentCount').value) || 0;
            const earlyLeave = parseInt(document.getElementById('earlyLeaveCount').value) || 0;

            if (!total || !present) {
                isValid = false;
            }

            if (present + late + absent + earlyLeave !== total) {
                isValid = false;
            }

            // ê¸°í”„í‹°ì½˜ í•„ë“œ ê²€ì‚¬
            document.querySelectorAll('.gifticon-item').forEach(item => {
                const nameInput = item.querySelector('[data-field="name"]');
                const phoneInput = item.querySelector('[data-field="phone"]');
                const reasonInput = item.querySelector('[data-field="reason"]');

                if (nameInput.value.trim() || phoneInput.value.trim() || reasonInput.value.trim()) {
                    if (!validateGifticonField(nameInput, 'name')) isValid = false;
                    if (!validateGifticonField(phoneInput, 'phone')) isValid = false;
                    if (!validateGifticonField(reasonInput, 'reason')) isValid = false;
                }
            });

            return isValid;
        }

        // ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ë“¤
        function validatePhoneNumber(phone) {
            const phoneRegex = /^01[0-9]-\d{3,4}-\d{4}$/;
            const phoneWithoutHyphen = /^01[0-9]\d{7,8}$/;
            
            return phoneRegex.test(phone) || phoneWithoutHyphen.test(phone.replace(/-/g, ''));
        }

        // ì¶œì„ì²´í¬ ì œì¶œ
        async function submitAttendance() {
            const appsScript = new AppsScriptManager();
            const submitBtn = document.getElementById('submitBtn');
            
            // ì‹œê°„ëŒ€ ì„ íƒ í™•ì¸
            if (!selectedTime) {
                showSubmitStatus('error', 'âš ï¸ ì¶œì„ì²´í¬ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì¶œì„ ë°ì´í„° ìˆ˜ì§‘
            const attendanceData = {
                timeSlot: selectedTime,
                date: new Date().toLocaleDateString('ko-KR'),
                totalCount: document.getElementById('totalCount').value,
                presentCount: document.getElementById('presentCount').value,
                lateCount: document.getElementById('lateCount').value || '0',
                absentCount: document.getElementById('absentCount').value || '0',
                earlyLeaveCount: document.getElementById('earlyLeaveCount').value || '0',
                specialNotes: document.getElementById('specialNotes').value,
            };

            // ê¸°í”„í‹°ì½˜ ë°ì´í„° ìˆ˜ì§‘ ë° ìœ íš¨ì„± ê²€ì‚¬
            const gifticonData = [];
            let hasValidGifticons = true;
            
            document.querySelectorAll('.gifticon-item').forEach((item, index) => {
                const name = item.querySelector('[data-field="name"]')?.value.trim();
                const company = item.querySelector('[data-field="company"]')?.value.trim();
                const phone = item.querySelector('[data-field="phone"]')?.value.trim();
                const reason = item.querySelector('[data-field="reason"]')?.value.trim();
                
                if (name || phone || reason) {
                    if (!name || !phone || !reason) {
                        hasValidGifticons = false;
                        showSubmitStatus('error', 'âš ï¸ ê¸°í”„í‹°ì½˜ ì •ë³´ëŠ” ì´ë¦„, í•¸ë“œí°ë²ˆí˜¸, ì§€ê¸‰ì‚¬ìœ ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    if (!validatePhoneNumber(phone)) {
                        hasValidGifticons = false;
                        showSubmitStatus('error', 'âš ï¸ ì˜¬ë°”ë¥¸ í•¸ë“œí°ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    gifticonData.push({
                        id: index + 1,
                        name: name,
                        company: company || '',
                        phone: phone,
                        reason: reason
                    });
                }
            });

            if (!hasValidGifticons) {
                return;
            }

            // ìµœì¢… ì œì¶œ ë°ì´í„° ìƒì„± (ë©˜í†  ì •ë³´ í¬í•¨)
            const submissionData = appsScript.createSubmissionData('attendance', {
                attendance: attendanceData,
                gifticons: gifticonData
            });

            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (!attendanceData.totalCount || !attendanceData.presentCount) {
                showSubmitStatus('error', 'âš ï¸ ì´ ì¸ì›ê³¼ ì¶œì„ ì¸ì›ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }

            // ì¶œì„ ì¸ì› ë…¼ë¦¬ ê²€ì¦
            const total = parseInt(attendanceData.totalCount);
            const present = parseInt(attendanceData.presentCount);
            const late = parseInt(attendanceData.lateCount);
            const absent = parseInt(attendanceData.absentCount);
            const earlyLeave = parseInt(attendanceData.earlyLeaveCount);
            
            if (present + late + absent + earlyLeave !== total) {
                showSubmitStatus('error', 'âš ï¸ ì¶œì„+ì§€ê°+ê²°ì„+ì¡°í‡´ ì¸ì›ì˜ í•©ì´ ì´ ì¸ì›ê³¼ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            // ì œì¶œ ì‹œì‘
            submitBtn.disabled = true;
            showSubmitStatus('loading', 'ğŸ“¤ ì œì¶œ ì¤‘ì…ë‹ˆë‹¤...');

            try {
                await appsScript.submitData(submissionData);
                
                showSubmitStatus('success', 'âœ… ì¶œì„ì²´í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');
                clearForm();
                
                // ì œì¶œ ê¸°ë¡ ì €ì¥
                appsScript.saveSubmissionRecord(submissionData);
                
            } catch (error) {
                console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                
                // ì˜¤í”„ë¼ì¸ ì €ì¥
                appsScript.saveOfflineData(submissionData);
                showSubmitStatus('error', 'âŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } finally {
                submitBtn.disabled = false;
            }
        }

        // ì œì¶œ ìƒíƒœ í‘œì‹œ
        function showSubmitStatus(type, message) {
            const statusDiv = document.getElementById('submitStatus');
            statusDiv.className = `submit-status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            // ì‹œê°„ëŒ€ ì„ íƒ ì´ˆê¸°í™”
            selectedTime = '';
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });

            // ì¶œì„ ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('totalCount').value = '';
            document.getElementById('presentCount').value = '';
            document.getElementById('lateCount').value = '0';
            document.getElementById('absentCount').value = '0';
            document.getElementById('earlyLeaveCount').value = '0';
            document.getElementById('specialNotes').value = '';

            // ê¸°í”„í‹°ì½˜ í•­ëª© ëª¨ë‘ ì œê±°
            document.getElementById('gifticonList').innerHTML = '';
            gifticonCount = 0;

            // ê¸€ììˆ˜ ì¹´ìš´í„° ì´ˆê¸°í™”
            updateCharacterCount();

            // í¼ ë¹„í™œì„±í™”
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = true;
                input.classList.remove('error', 'valid');
            });
        }

        // ë’¤ë¡œê°€ê¸° í•¨ìˆ˜ëŠ” ì´ë¯¸ headì—ì„œ ì •ì˜ë¨

        // ê°œë°œììš© ì„¤ì • í•¨ìˆ˜
        function setAppsScriptUrl(url) {
            localStorage.setItem('sk-mentor-apps-script-url', url);
            console.log('ğŸ”§ Apps Script URL ì„¤ì •ë¨:', url);
        }

        // ì˜¤í”„ë¼ì¸ ë°ì´í„° ë™ê¸°í™” (í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰)
        window.addEventListener('online', async function() {
            console.log('ğŸŒ ì¸í„°ë„· ì—°ê²°ë¨ - ì˜¤í”„ë¼ì¸ ë°ì´í„° ë™ê¸°í™” ì‹œë„');
            
            const appsScript = new AppsScriptManager();
            const offlineData = JSON.parse(localStorage.getItem('sk-mentor-offline-submissions') || '[]');
            
            if (offlineData.length > 0) {
                try {
                    let successCount = 0;
                    
                    for (const submission of offlineData) {
                        try {
                            await appsScript.submitData(submission);
                            appsScript.saveSubmissionRecord(submission);
                            successCount++;
                        } catch (error) {
                            console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
                            break;
                        }
                    }
                    
                    if (successCount > 0) {
                        // ì„±ê³µí•œ ë°ì´í„°ëŠ” ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œì—ì„œ ì œê±°
                        const remainingData = offlineData.slice(successCount);
                        localStorage.setItem('sk-mentor-offline-submissions', JSON.stringify(remainingData));
                        
                        if (document.getElementById('submitStatus')) {
                            showSubmitStatus('success', `âœ… ì˜¤í”„ë¼ì¸ ì¤‘ ì €ì¥ëœ ${successCount}ê±´ì˜ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                        }
                    }
                } catch (error) {
                    console.error('ì˜¤í”„ë¼ì¸ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:', error);
                }
            }
        });

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë©˜í†  ì •ë³´ í™•ì¸
            const mentorInfo = localStorage.getItem('sk-mentor-info');
            
            if (!mentorInfo) {
                alert('ë©˜í†  ì •ë³´ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                window.location.href = '../index.html';
                return;
            }
            
            // ë©˜í†  ì •ë³´ê°€ ìˆìœ¼ë©´ ì •ìƒ ì§„í–‰
            const mentor = JSON.parse(mentorInfo);
            console.log('ë©˜í†  ì •ë³´ í™•ì¸ë¨:', mentor.name);
            
            // ê¸°ì¡´ ì½”ë“œë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
            // í¼ ë¹„í™œì„±í™”
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = true;
            });

            // ê¸€ììˆ˜ ì¹´ìš´í„° ì´ˆê¸°í™”
            updateCharacterCount();

            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('lateCount').value = '0';
            document.getElementById('absentCount').value = '0';
            document.getElementById('earlyLeaveCount').value = '0';
        });
    </script>
</body>
</html>
