<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Ï∂úÏÑùÏ≤¥ÌÅ¨ - SK Î©òÌÜ† Í∞ÄÏù¥Îìú</title>
    <meta name="theme-color" content="#1976d2">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
            color: #202124;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1976d2, #42a5f5);
            color: white;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(25, 118, 210, 0.3);
            position: relative;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 16px;
            transition: background 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Section */
        .section {
            background: white;
            margin-bottom: 24px;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section h2 {
            font-size: 20px;
            margin-bottom: 16px;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù */
        .time-selector {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border: 2px solid #1976d2;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .time-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .time-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .time-option:hover {
            border-color: #1976d2;
            transform: translateY(-2px);
        }

        .time-option.selected {
            border-color: #1976d2;
            background: #e3f2fd;
        }

        .time-option h3 {
            color: #1976d2;
            margin-bottom: 8px;
        }

        .time-option p {
            color: #666;
            font-size: 14px;
        }

        /* Ï∂úÏÑù ÌòÑÌô© */
        .attendance-form {
            background: #f8f9fa;
            border: 2px solid #1976d2;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
        }

        .form-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            border-left: 4px solid #1976d2;
        }

        .form-section h4 {
            color: #1976d2;
            margin-bottom: 16px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .attendance-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .form-input.error {
            border-color: #f44336;
            background-color: #fff5f5;
        }

        .form-input.valid {
            border-color: #4caf50;
            background-color: #f8fff8;
        }

        /* ÌäπÏù¥ÏÇ¨Ìï≠ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .special-notes-section {
            grid-column: 1 / -1;
        }

        .special-notes-textarea {
            min-height: 120px;
            max-height: 300px;
            line-height: 1.5;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            width: 100%;
        }

        .special-notes-textarea:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .character-count {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .character-count.warning {
            color: #ff9800;
        }

        .character-count.error {
            color: #f44336;
        }

        /* Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â */
        .gifticon-section {
            background: linear-gradient(135deg, #fff3e0, #fce4ec);
            border: 2px solid #ff9800;
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
        }

        .gifticon-title {
            color: #e65100;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
        }

        .gifticon-list {
            display: grid;
            gap: 16px;
        }

        .gifticon-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #ff9800;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 16px;
        }

        .gifticon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .gifticon-number {
            background: #ff9800;
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .remove-gifticon {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .remove-gifticon:hover {
            background: #d32f2f;
        }

        .gifticon-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .gifticon-form .attendance-item:nth-child(4) {
            grid-column: 1 / -1;
        }

        .add-gifticon {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);
        }

        .add-gifticon:hover {
            background: linear-gradient(135deg, #f57c00, #ef6c00);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        /* Ï†úÏ∂ú ÏÑπÏÖò */
        .submit-section {
            background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
            border: 2px solid #4caf50;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }

        .submit-button {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .submit-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .submit-status {
            margin-top: 12px;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        .submit-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .submit-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .submit-status.loading {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }

        /* ÏïàÎÇ¥ Î∞ïÏä§ */
        .info-box {
            background: linear-gradient(135deg, #fff3e0, #fce4ec);
            border: 1px solid #ffb74d;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .info-title {
            font-weight: 600;
            color: #e65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ÏóêÎü¨ Î©îÏãúÏßÄ Ïä§ÌÉÄÏùº */
        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 4px;
            min-height: 18px;
            display: block;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .section {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .header h1 {
                font-size: 20px;
            }

            .time-options {
                grid-template-columns: 1fr;
            }

            .attendance-grid {
                grid-template-columns: 1fr;
            }

            .gifticon-form {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .gifticon-form .attendance-item:nth-child(4) {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <button class="back-button" onclick="goBack()">‚Üê Îí§Î°úÍ∞ÄÍ∏∞</button>
        <h1>üìã Ï∂úÏÑùÏ≤¥ÌÅ¨ ÏãúÏä§ÌÖú</h1>
        <div class="subtitle">Ïò§Ï†Ñ 9Ïãú & Ïò§ÌõÑ 2Ïãú Ï∂úÏÑù ÌòÑÌô© Ï†úÏ∂ú</div>
    </div>

    <div class="container">
        <!-- ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù -->
        <div class="section">
            <h2>‚è∞ Ï∂úÏÑùÏ≤¥ÌÅ¨ ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù</h2>
            <div class="time-selector">
                <div class="time-options">
                    <div class="time-option" data-time="morning" onclick="selectTime('morning')">
                        <h3>üåÖ Ïò§Ï†Ñ Ï∂úÏÑùÏ≤¥ÌÅ¨</h3>
                        <p>Ïò§Ï†Ñ 9Ïãú Í∏∞Ï§Ä<br>ÍµêÏú° ÏãúÏûë Ï†Ñ Ï∂úÏÑù ÌòÑÌô©</p>
                    </div>
                    <div class="time-option" data-time="afternoon" onclick="selectTime('afternoon')">
                        <h3>üåû Ïò§ÌõÑ Ï∂úÏÑùÏ≤¥ÌÅ¨</h3>
                        <p>Ïò§ÌõÑ 2Ïãú Í∏∞Ï§Ä<br>Ï†êÏã¨ ÌõÑ Ï∂úÏÑù ÌòÑÌô©</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ï∂úÏÑù ÌòÑÌô© Ìèº -->
        <div class="section">
            <h2>üìä Ï∂úÏÑù ÌòÑÌô© ÏûÖÎ†•</h2>
            <div class="attendance-form">
                <div class="form-section">
                    <h4>üë• Ï∂úÏÑù Ïù∏Ïõê ÌòÑÌô©</h4>
                    <div class="attendance-grid">
                        <div class="attendance-item">
                            <label class="form-label">Ï¥ù Ïù∏Ïõê</label>
                            <input type="number" class="form-input" id="totalCount" placeholder="12" min="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">Ï∂úÏÑù</label>
                            <input type="number" class="form-input" id="presentCount" placeholder="11" min="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">ÏßÄÍ∞Å</label>
                            <input type="number" class="form-input" id="lateCount" placeholder="1" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">Í≤∞ÏÑù</label>
                            <input type="number" class="form-input" id="absentCount" placeholder="0" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                        <div class="attendance-item">
                            <label class="form-label">Ï°∞Ìá¥</label>
                            <input type="number" class="form-input" id="earlyLeaveCount" placeholder="0" min="0" value="0" oninput="validateAttendanceNumbers()">
                        </div>
                    </div>
                </div>

                <div class="form-section special-notes-section">
                    <h4>üìù ÌäπÏù¥ÏÇ¨Ìï≠</h4>
                    <textarea class="special-notes-textarea" id="specialNotes" placeholder="ÏßÄÍ∞Å/Í≤∞ÏÑù/Ï°∞Ìá¥ ÏÇ¨Ïú†, Ïª®ÎîîÏÖò ÎÇúÏ°∞Ïûê, Í∏∞ÌÉÄ ÌäπÏù¥ÏÇ¨Ìï≠ Îì±ÏùÑ ÏûêÏÑ∏Ìûà Í∏∞Î°ùÌï¥Ï£ºÏÑ∏Ïöî.&#10;&#10;ÏòàÏãú:&#10;- ÌôçÍ∏∏Îèô: ÍµêÌÜµÏ≤¥Ï¶ùÏúºÎ°ú Ïù∏Ìïú ÏßÄÍ∞Å (15Î∂Ñ)&#10;- ÍπÄÏ≤†Ïàò: Î™∏ÏÇ¥ Í∏∞Ïö¥ÏúºÎ°ú Ïª®ÎîîÏÖò ÎÇúÏ°∞&#10;- Ïù¥ÏòÅÌù¨: Í∏âÌïú ÏóÖÎ¨¥Î°ú Ïù∏Ìïú Ï°∞Ìá¥ (16:30)" maxlength="500" oninput="updateCharacterCount()"></textarea>
                    <div class="character-count" id="notesCharCount">0 / 500Ïûê</div>
                </div>
            </div>
        </div>

        <!-- Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â ÌòÑÌô© -->
        <div class="section">
            <h2>üéÅ Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â ÌòÑÌô©</h2>
            <div class="gifticon-section">
                <div class="gifticon-title">üéâ Ï∞∏Ïó¨ ÎèÖÎ†§ Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â</div>
                
                <div class="info-box">
                    <div class="info-title">üí° Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â Í∞ÄÏù¥Îìú</div>
                    <ul style="margin-left: 16px; margin-top: 8px;">
                        <li>Ï†ÅÍ∑πÏ†Å Ï∞∏Ïó¨, Ïö∞ÏàòÌïú Î∞úÌëú, ÌåÄÏõåÌÅ¨ Ìñ•ÏÉÅ Îì±Ïóê ÎåÄÌïú Í≤©Î†§</li>
                        <li>Îß§Ïùº Í∏∞Î°ùÌï† ÌïÑÏöîÎäî ÏóÜÏúºÎ©∞, ÌäπÎ≥ÑÌïú Í≤ΩÏö∞ÏóêÎßå ÏßÄÍ∏â</li>
                        <li>ÏàòÎ†πÏûê Ï†ïÎ≥¥Îäî Í∏∞ÌîÑÌã∞ÏΩò Î∞úÏÜ°ÏùÑ ÏúÑÌï¥ Ï†ïÌôïÌûà Í∏∞ÏûÖ</li>
                    </ul>
                </div>

                <div class="gifticon-list" id="gifticonList">
                    <!-- Í∏∞ÌîÑÌã∞ÏΩò Ìï≠Î™©Îì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>

                <button class="add-gifticon" onclick="addGifticonItem()">+ Í∏∞ÌîÑÌã∞ÏΩò ÏßÄÍ∏â Ï∂îÍ∞Ä</button>
            </div>
        </div>

        <!-- Ï†úÏ∂ú ÏÑπÏÖò -->
        <div class="section">
            <h2>üì§ Ï∂úÏÑùÏ≤¥ÌÅ¨ Ï†úÏ∂ú</h2>
            <div class="submit-section">
                <h3 style="margin-bottom: 16px; color: #2e7d32;">‚úÖ Ïö¥ÏòÅÏßÑÏóêÍ≤å ÏûêÎèô Ï†úÏ∂ú</h3>
                <p style="margin-bottom: 20px; color: #666;">
                    Ï†úÏ∂úÌïòÍ∏∞ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Ï∂úÏÑù ÌòÑÌô©Ïù¥ Ïö¥ÏòÅÏßÑÏóêÍ≤å ÏûêÎèôÏúºÎ°ú Ï†úÏ∂úÎê©ÎãàÎã§.<br>
                    Ï†úÏ∂ú Ï†Ñ ÎÇ¥Ïö©ÏùÑ Îã§Ïãú Ìïú Î≤à ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.
                </p>
                
                <button class="submit-button" onclick="submitAttendance()" id="submitBtn">
                    üì§ Ïö¥ÏòÅÏßÑÏóêÍ≤å Ï†úÏ∂úÌïòÍ∏∞
                </button>
                
                <div class="submit-status" id="submitStatus"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedTime = '';
        let gifticonCount = 0;

        // Apps Script Í¥ÄÎ¶¨ ÌÅ¥ÎûòÏä§
        class AppsScriptManager {
            constructor() {
                // üîß Ïó¨Í∏∞Ïóê Ïã§Ï†ú Apps Script ÏõπÏï± URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                this.APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx_sWKPsECUK7VvG9-6p8HNw_7s2h3C_VLxlOn7_PlHaZiRvyJWVAYBrr8nfEPDpIXJTw/exec';
                this.isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            }

            getAppsScriptUrl() {
                // Í∞úÎ∞ú ÌôòÍ≤ΩÏóêÏÑúÎäî Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÌôïÏù∏
                if (this.isDevelopment) {
                    const devUrl = localStorage.getItem('sk-mentor-apps-script-url');
                    if (devUrl) return devUrl;
                }
                
                // Ïã§Ï†ú URL ÏÇ¨Ïö©
                return this.APPS_SCRIPT_URL;
            }

            createSubmissionData(type, formData) {
                const mentorInfo = JSON.parse(localStorage.getItem('sk-mentor-info') || '{}');
                
                const baseData = {
                    type: type,
                    mentorName: mentorInfo.name || localStorage.getItem('sk-mentor-name') || 'ÎØ∏ÏûÖÎ†•',
                    teamNumber: mentorInfo.teamNumber || '',
                    trainingCenter: mentorInfo.trainingCenter || '',
                    submittedAt: new Date().toLocaleString('ko-KR')
                };
                
                return { ...baseData, ...formData };
            }

            async submitData(data) {
                const url = this.getAppsScriptUrl();
                
                if (!url) {
                    throw new Error('Apps Script URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïö¥ÏòÅÏßÑÏóêÍ≤å Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî.');
                }

                console.log('üì§ Ï†ÑÏÜ° Îç∞Ïù¥ÌÑ∞:', data);

                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                return { success: true, message: 'Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§' };
            }

            saveOfflineData(data) {
                const offlineData = JSON.parse(localStorage.getItem('sk-mentor-offline-submissions') || '[]');
                offlineData.push({
                    ...data,
                    id: Date.now(),
                    status: 'pending',
                    savedAt: new Date().toISOString()
                });
                localStorage.setItem('sk-mentor-offline-submissions', JSON.stringify(offlineData));
            }

            saveSubmissionRecord(data) {
                const submissions = JSON.parse(localStorage.getItem('sk-mentor-submissions') || '[]');
                submissions.push({
                    ...data,
                    id: Date.now(),
                    status: 'submitted'
                });
                localStorage.setItem('sk-mentor-submissions', JSON.stringify(submissions));
            }
        }

        // ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù
        function selectTime(time) {
            selectedTime = time;
            
            // Î™®Îì† ÏòµÏÖò ÎπÑÏÑ†ÌÉù
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ÏÑ†ÌÉùÎêú ÏòµÏÖò ÌëúÏãú
            document.querySelector(`[data-time="${time}"]`).classList.add('selected');
            
            // Ìèº ÌôúÏÑ±Ìôî
            enableForm();
        }

        // Ìèº ÌôúÏÑ±Ìôî
        function enableForm() {
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = false;
            });
        }

        // Ï∂úÏÑù Ïù∏Ïõê Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
        function validateAttendanceNumbers() {
            const total = parseInt(document.getElementById('totalCount').value) || 0;
            const present = parseInt(document.getElementById('presentCount').value) || 0;
            const late = parseInt(document.getElementById('lateCount').value) || 0;
            const absent = parseInt(document.getElementById('absentCount').value) || 0;
            const earlyLeave = parseInt(document.getElementById('earlyLeaveCount').value) || 0;

            const sum = present + late + absent + earlyLeave;
            
            // ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
            const inputs = [
                document.getElementById('totalCount'),
                document.getElementById('presentCount'),
                document.getElementById('lateCount'),
                document.getElementById('absentCount'),
                document.getElementById('earlyLeaveCount')
            ];

            inputs.forEach(input => {
                input.classList.remove('error', 'valid');
            });

            if (total > 0 && sum === total) {
                inputs.forEach(input => input.classList.add('valid'));
            } else if (total > 0 && sum !== total) {
                inputs.forEach(input => input.classList.add('error'));
            }
        }

        // ÌäπÏù¥ÏÇ¨Ìï≠ Í∏ÄÏûêÏàò Ïπ¥Ïö¥Ìä∏
        function updateCharacterCount() {
            const textarea = document.getElementById('specialNotes');
            const counter = document.getElementById('notesCharCount');
            const length = textarea.value.length;
            
            counter.textContent = `${length} / 500Ïûê`;
            
            counter.classList.remove('warning', 'error');
            if (length > 450) {
                counter.classList.add('warning');
            }
            if (length > 500) {
                counter.classList.add('error');
            }
        }

        // Í∏∞ÌîÑÌã∞ÏΩò Ìï≠Î™© Ï∂îÍ∞Ä
        function addGifticonItem() {
            gifticonCount++;
            const gifticonList = document.getElementById('gifticonList');
            
            const gifticonItem = document.createElement('div');
            gifticonItem.className = 'gifticon-item';
            gifticonItem.id = `gifticon-${gifticonCount}`;
            
            gifticonItem.innerHTML = `
                <div class="gifticon-header">
                    <span class="gifticon-number">#${gifticonCount}</span>
                    <button class="remove-gifticon" onclick="removeGifticonItem(${gifticonCount})">ÏÇ≠Ï†ú</button>
                </div>
                <div class="gifticon-form">
                    <div class="attendance-item">
                        <label class="form-label">Ïù¥Î¶Ñ <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" placeholder="ÌôçÍ∏∏Îèô" data-field="name" required oninput="validateGifticonField(this, 'name')">
                        <div class="error-message" data-error="name"></div>
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">ÌöåÏÇ¨</label>
                        <input type="text" class="form-input" placeholder="SKÌÖîÎ†àÏΩ§" data-field="company">
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">Ìï∏ÎìúÌè∞Î≤àÌò∏ <span style="color: red;">*</span></label>
                        <input type="tel" class="form-input" placeholder="010-1234-5678" data-field="phone" required oninput="validateGifticonField(this, 'phone')">
                        <div class="error-message" data-error="phone"></div>
                    </div>
                    <div class="attendance-item">
                        <label class="form-label">ÏßÄÍ∏â ÏÇ¨Ïú† <span style="color: red;">*</span></label>
                        <input type="text" class="form-input" placeholder="Ï†ÅÍ∑πÏ†ÅÏù∏ Î∞úÌëú Ï∞∏Ïó¨, Ïö∞ÏàòÌïú ÌåÄÏõåÌÅ¨ Îì±" data-field="reason" required oninput="validateGifticonField(this, 'reason')">
                        <div class="error-message" data-error="reason"></div>
                    </div>
                </div>
            `;
            
            gifticonList.appendChild(gifticonItem);
        }

        // Í∏∞ÌîÑÌã∞ÏΩò Ìï≠Î™© ÏÇ≠Ï†ú
        function removeGifticonItem(id) {
            const item = document.getElementById(`gifticon-${id}`);
            if (item) {
                item.remove();
            }
        }

        // Í∏∞ÌîÑÌã∞ÏΩò ÌïÑÎìú Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
        function validateGifticonField(input, type) {
            const errorElement = input.parentElement.querySelector(`[data-error="${type}"]`);
            let isValid = true;
            let errorMessage = '';

            input.classList.remove('error', 'valid');

            if (input.value.trim()) {
                switch (type) {
                    case 'name':
                        if (input.value.trim().length < 2) {
                            isValid = false;
                            errorMessage = 'Ïù¥Î¶ÑÏùÄ 2Í∏ÄÏûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                        }
                        break;
                    case 'phone':
                        if (!validatePhoneNumber(input.value)) {
                            isValid = false;
                            errorMessage = 'Ïò¨Î∞îÎ•∏ Ìï∏ÎìúÌè∞Î≤àÌò∏ ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (Ïòà: 010-1234-5678)';
                        }
                        break;
                    case 'reason':
                        if (input.value.trim().length < 2) {
                            isValid = false;
                            errorMessage = 'ÏßÄÍ∏â ÏÇ¨Ïú†Î•º ÏûêÏÑ∏Ìûà ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                        }
                        break;
                }

                if (isValid) {
                    input.classList.add('valid');
                } else {
                    input.classList.add('error');
                }
            }

            if (errorElement) {
                errorElement.textContent = errorMessage;
            }

            return isValid;
        }

        // Ï†ÑÏ≤¥ Ìèº Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
        function validateAllForms() {
            let isValid = true;

            // Ï∂úÏÑù Ïù∏Ïõê Í≤ÄÏÇ¨
            const total = parseInt(document.getElementById('totalCount').value) || 0;
            const present = parseInt(document.getElementById('presentCount').value) || 0;
            const late = parseInt(document.getElementById('lateCount').value) || 0;
            const absent = parseInt(document.getElementById('absentCount').value) || 0;
            const earlyLeave = parseInt(document.getElementById('earlyLeaveCount').value) || 0;

            if (!total || !present) {
                isValid = false;
            }

            if (present + late + absent + earlyLeave !== total) {
                isValid = false;
            }

            // Í∏∞ÌîÑÌã∞ÏΩò ÌïÑÎìú Í≤ÄÏÇ¨
            document.querySelectorAll('.gifticon-item').forEach(item => {
                const nameInput = item.querySelector('[data-field="name"]');
                const phoneInput = item.querySelector('[data-field="phone"]');
                const reasonInput = item.querySelector('[data-field="reason"]');

                if (nameInput.value.trim() || phoneInput.value.trim() || reasonInput.value.trim()) {
                    if (!validateGifticonField(nameInput, 'name')) isValid = false;
                    if (!validateGifticonField(phoneInput, 'phone')) isValid = false;
                    if (!validateGifticonField(reasonInput, 'reason')) isValid = false;
                }
            });

            return isValid;
        }

        // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Ìï®ÏàòÎì§
        function validatePhoneNumber(phone) {
            const phoneRegex = /^01[0-9]-\d{3,4}-\d{4}$/;
            const phoneWithoutHyphen = /^01[0-9]\d{7,8}$/;
            
            return phoneRegex.test(phone) || phoneWithoutHyphen.test(phone.replace(/-/g, ''));
        }

        // Ï∂úÏÑùÏ≤¥ÌÅ¨ Ï†úÏ∂ú
        async function submitAttendance() {
            const appsScript = new AppsScriptManager();
            const submitBtn = document.getElementById('submitBtn');
            
            // ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù ÌôïÏù∏
            if (!selectedTime) {
                showSubmitStatus('error', '‚ö†Ô∏è Ï∂úÏÑùÏ≤¥ÌÅ¨ ÏãúÍ∞ÑÎåÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const attendanceData = {
                timeSlot: selectedTime,
                date: new Date().toLocaleDateString('ko-KR'),
                totalCount: document.getElementById('totalCount').value,
                presentCount: document.getElementById('presentCount').value,
                lateCount: document.getElementById('lateCount').value || '0',
                absentCount: document.getElementById('absentCount').value || '0',
                earlyLeaveCount: document.getElementById('earlyLeaveCount').value || '0',
                specialNotes: document.getElementById('specialNotes').value,
            };

            // Í∏∞ÌîÑÌã∞ÏΩò Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Î∞è Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            const gifticonData = [];
            let hasValidGifticons = true;
            
            document.querySelectorAll('.gifticon-item').forEach((item, index) => {
                const name = item.querySelector('[data-field="name"]')?.value.trim();
                const company = item.querySelector('[data-field="company"]')?.value.trim();
                const phone = item.querySelector('[data-field="phone"]')?.value.trim();
                const reason = item.querySelector('[data-field="reason"]')?.value.trim();
                
                if (name || phone || reason) {
                    if (!name || !phone || !reason) {
                        hasValidGifticons = false;
                        showSubmitStatus('error', '‚ö†Ô∏è Í∏∞ÌîÑÌã∞ÏΩò Ï†ïÎ≥¥Îäî Ïù¥Î¶Ñ, Ìï∏ÎìúÌè∞Î≤àÌò∏, ÏßÄÍ∏âÏÇ¨Ïú†Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    if (!validatePhoneNumber(phone)) {
                        hasValidGifticons = false;
                        showSubmitStatus('error', '‚ö†Ô∏è Ïò¨Î∞îÎ•∏ Ìï∏ÎìúÌè∞Î≤àÌò∏ ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    
                    gifticonData.push({
                        id: index + 1,
                        name: name,
                        company: company || '',
                        phone: phone,
                        reason: reason
                    });
                }
            });

            if (!hasValidGifticons) {
                return;
            }

            // ÏµúÏ¢Ö Ï†úÏ∂ú Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (Î©òÌÜ† Ï†ïÎ≥¥ Ìè¨Ìï®)
            const submissionData = appsScript.createSubmissionData('attendance', {
                attendance: attendanceData,
                gifticons: gifticonData
            });

            // ÌïÑÏàò ÌïÑÎìú Í≤ÄÏ¶ù
            if (!attendanceData.totalCount || !attendanceData.presentCount) {
                showSubmitStatus('error', '‚ö†Ô∏è Ï¥ù Ïù∏ÏõêÍ≥º Ï∂úÏÑù Ïù∏ÏõêÏùÄ ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§.');
                return;
            }

            // Ï∂úÏÑù Ïù∏Ïõê ÎÖºÎ¶¨ Í≤ÄÏ¶ù
            const total = parseInt(attendanceData.totalCount);
            const present = parseInt(attendanceData.presentCount);
            const late = parseInt(attendanceData.lateCount);
            const absent = parseInt(attendanceData.absentCount);
            const earlyLeave = parseInt(attendanceData.earlyLeaveCount);
            
            if (present + late + absent + earlyLeave !== total) {
                showSubmitStatus('error', '‚ö†Ô∏è Ï∂úÏÑù+ÏßÄÍ∞Å+Í≤∞ÏÑù+Ï°∞Ìá¥ Ïù∏ÏõêÏùò Ìï©Ïù¥ Ï¥ù Ïù∏ÏõêÍ≥º ÎßûÏßÄ ÏïäÏäµÎãàÎã§.');
                return;
            }

            // Ï†úÏ∂ú ÏãúÏûë
            submitBtn.disabled = true;
            showSubmitStatus('loading', 'üì§ Ï†úÏ∂ú Ï§ëÏûÖÎãàÎã§...');

            try {
                await appsScript.submitData(submissionData);
                
                showSubmitStatus('success', '‚úÖ Ï∂úÏÑùÏ≤¥ÌÅ¨Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§!');
                clearForm();
                
                // Ï†úÏ∂ú Í∏∞Î°ù Ï†ÄÏû•
                appsScript.saveSubmissionRecord(submissionData);
                
            } catch (error) {
                console.error('Ï†úÏ∂ú Ïò§Î•ò:', error);
                
                // Ïò§ÌîÑÎùºÏù∏ Ï†ÄÏû•
                appsScript.saveOfflineData(submissionData);
                showSubmitStatus('error', '‚ùå Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî. Ïò§ÌîÑÎùºÏù∏ÏúºÎ°ú ÏûÑÏãú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                
            } finally {
                submitBtn.disabled = false;
            }
        }

        // Ï†úÏ∂ú ÏÉÅÌÉú ÌëúÏãú
        function showSubmitStatus(type, message) {
            const statusDiv = document.getElementById('submitStatus');
            statusDiv.className = `submit-status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Ìèº Ï¥àÍ∏∞Ìôî
        function clearForm() {
            // ÏãúÍ∞ÑÎåÄ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            selectedTime = '';
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            document.getElementById('totalCount').value = '';
            document.getElementById('presentCount').value = '';
            document.getElementById('lateCount').value = '0';
            document.getElementById('absentCount').value = '0';
            document.getElementById('earlyLeaveCount').value = '0';
            document.getElementById('specialNotes').value = '';

            // Í∏∞ÌîÑÌã∞ÏΩò Ìï≠Î™© Î™®Îëê Ï†úÍ±∞
            document.getElementById('gifticonList').innerHTML = '';
            gifticonCount = 0;

            // Í∏ÄÏûêÏàò Ïπ¥Ïö¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            updateCharacterCount();

            // Ìèº ÎπÑÌôúÏÑ±Ìôî
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = true;
                input.classList.remove('error', 'valid');
            });
        }

        // Îí§Î°úÍ∞ÄÍ∏∞
        function goBack() {
             if (document.referrer) {
                 window.history.back();
             } else {
                 // Î£®Ìä∏ Í∏∞Ï§ÄÏúºÎ°ú index.html Ïù¥Îèô
                 const baseUrl = window.location.origin + window.location.pathname.split('/guides')[0];
                 window.location.href = baseUrl + '/index.html';
             }
        }

        // Í∞úÎ∞úÏûêÏö© ÏÑ§Ï†ï Ìï®Ïàò
        function setAppsScriptUrl(url) {
            localStorage.setItem('sk-mentor-apps-script-url', url);
            console.log('üîß Apps Script URL ÏÑ§Ï†ïÎê®:', url);
        }

        // Ïò§ÌîÑÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî (ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ïã§Ìñâ)
        window.addEventListener('online', async function() {
            console.log('üåê Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞Îê® - Ïò§ÌîÑÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî ÏãúÎèÑ');
            
            const appsScript = new AppsScriptManager();
            const offlineData = JSON.parse(localStorage.getItem('sk-mentor-offline-submissions') || '[]');
            
            if (offlineData.length > 0) {
                try {
                    let successCount = 0;
                    
                    for (const submission of offlineData) {
                        try {
                            await appsScript.submitData(submission);
                            appsScript.saveSubmissionRecord(submission);
                            successCount++;
                        } catch (error) {
                            console.error('ÎèôÍ∏∞Ìôî Ïã§Ìå®:', error);
                            break;
                        }
                    }
                    
                    if (successCount > 0) {
                        // ÏÑ±Í≥µÌïú Îç∞Ïù¥ÌÑ∞Îäî Ïò§ÌîÑÎùºÏù∏ Ï†ÄÏû•ÏÜåÏóêÏÑú Ï†úÍ±∞
                        const remainingData = offlineData.slice(successCount);
                        localStorage.setItem('sk-mentor-offline-submissions', JSON.stringify(remainingData));
                        
                        if (document.getElementById('submitStatus')) {
                            showSubmitStatus('success', `‚úÖ Ïò§ÌîÑÎùºÏù∏ Ï§ë Ï†ÄÏû•Îêú ${successCount}Í±¥Ïùò Îç∞Ïù¥ÌÑ∞Í∞Ä ÎèôÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§!`);
                        }
                    }
                } catch (error) {
                    console.error('Ïò§ÌîÑÎùºÏù∏ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ïã§Ìå®:', error);
                }
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // Ìèº ÎπÑÌôúÏÑ±Ìôî
            const formInputs = document.querySelectorAll('.form-input, .special-notes-textarea');
            formInputs.forEach(input => {
                input.disabled = true;
            });

            // Í∏ÄÏûêÏàò Ïπ¥Ïö¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            updateCharacterCount();

            // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            document.getElementById('lateCount').value = '0';
            document.getElementById('absentCount').value = '0';
            document.getElementById('earlyLeaveCount').value = '0';
        });
    </script>
</body>
</html>